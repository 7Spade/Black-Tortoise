---
description: 'Angular 動畫現代化 API - 效能與體驗優化'
applyTo: '**/*.component.ts,**/*.animations.ts'
---

# Angular 動畫現代化 API

## 核心概念

Angular 動畫系統基於 Web Animations API，提供聲明式的動畫定義方式。在 Angular 20+ 中，動畫與 Signals 和現代控制流的整合變得更加緊密。

## 動畫模組導入

### Standalone Components 配置
模組設定:
- 使用 `provideAnimations()` 啟用動畫
- 或使用 `provideNoopAnimations()` 禁用 (測試環境)
- 在元件中導入 BrowserAnimationsModule (非 standalone 時)
- 按需導入動畫函數

### 效能考量
啟用策略:
- 預設啟用動畫 (生產環境)
- 測試環境禁用動畫加快測試
- 提供使用者偏好設定 (無障礙需求)
- 偵測低效能裝置自動調整

## 動畫定義方式

### 元件動畫
定義位置:
- 在 `@Component` 裝飾器的 `animations` 陣列
- 分離到獨立檔案 (大型動畫集)
- 可重用的動畫定義
- 命名動畫觸發器

### 動畫語法結構
基本元素:
- **trigger**: 定義動畫觸發器名稱
- **state**: 定義動畫狀態
- **transition**: 定義狀態轉換
- **style**: 定義樣式屬性
- **animate**: 定義動畫時間和緩動

### 狀態與轉換
狀態定義:
- 明確狀態 (open, closed, active)
- 通配符狀態 (`*` 表示任意狀態)
- void 狀態 (元素進入/離開 DOM)
- 雙向轉換 (`open <=> closed`)

## 常見動畫模式

### 進入/離開動畫
典型場景:
- 元素淡入淡出
- 滑入滑出效果
- 縮放動畫
- 旋轉展開

觸發時機:
- 使用 `@if` 控制元素存在
- 元素添加到 `@for` 列表
- 路由導航時
- 對話框開啟關閉

### 狀態切換動畫
應用場景:
- 展開/收合面板
- 激活/非激活狀態
- 選中/未選中
- 載入狀態指示

### 列表動畫
集合操作:
- 列表項目進入動畫
- 列表項目離開動畫
- 重新排序動畫
- 交錯動畫效果

### 路由動畫
頁面切換:
- 滑動過場
- 淡入淡出
- 縮放效果
- 自訂轉場動畫

## 動畫時間與緩動

### 時間設定
語法格式:
- 單一數值: 持續時間 (如 '300ms')
- 完整格式: 持續時間 + 延遲 + 緩動 ('300ms 100ms ease-in')
- 使用常數定義可重用時間

### 緩動函數
內建選項:
- **ease**: 預設緩動
- **ease-in**: 慢入
- **ease-out**: 慢出
- **ease-in-out**: 慢入慢出
- **linear**: 線性
- **cubic-bezier**: 自訂貝塞爾曲線

選擇原則:
- 進入動畫使用 ease-out (快速開始)
- 離開動畫使用 ease-in (快速結束)
- 注意動畫使用 ease-in-out
- 持續動畫使用 linear

## 進階動畫技巧

### 序列與並行
組合方式:
- **sequence**: 動畫依序執行
- **group**: 動畫並行執行
- **stagger**: 交錯執行 (列表動畫)
- 混合使用創造複雜效果

### 動畫回呼
事件監聽:
- `@trigger.start`: 動畫開始
- `@trigger.done`: 動畫完成
- 獲取動畫狀態
- 執行後續邏輯

### 動畫參數化
可重用動畫:
- 使用 `params` 傳遞參數
- 動態時間和樣式值
- 提高動畫靈活性
- 減少重複程式碼

### 查詢與動畫子元素
複雜場景:
- 使用 `query()` 選擇子元素
- `animateChild()` 觸發子動畫
- 協調父子動畫
- 創造豐富效果

## 與 Signals 整合

### Signal 驅動的動畫
觸發機制:
- Signal 值變化觸發動畫
- 使用 `computed()` 計算動畫狀態
- `effect()` 中執行動畫邏輯
- 保持響應式資料流

### 動畫狀態管理
狀態追蹤:
- 使用 Signal 儲存當前動畫狀態
- 動畫完成後更新 Signal
- 多個元件同步動畫狀態
- 整合到 SignalStore

## 效能最佳化

### 動畫效能原則
最佳實踐:
- 優先使用 transform 和 opacity (GPU 加速)
- 避免動畫 layout 屬性 (width, height, top, left)
- 使用 `will-change` CSS 屬性提示瀏覽器
- 限制同時執行的動畫數量

### 複雜動畫優化
策略:
- 簡化動畫步驟
- 減少動畫元素數量
- 使用 CSS 動畫替代 (簡單場景)
- 針對低效能裝置降級

### 記憶體管理
注意事項:
- 清理動畫監聽器
- 避免動畫導致的記憶體洩漏
- 大量元素動畫時使用虛擬滾動
- 適時禁用非關鍵動畫

## 無障礙性考量

### prefers-reduced-motion
尊重使用者偏好:
- 偵測系統設定
- 提供禁用動畫選項
- 簡化或移除非必要動畫
- 保持功能完整性

### 動畫與螢幕閱讀器
注意事項:
- 動畫不應影響內容可讀性
- 重要狀態變化使用 ARIA live regions
- 避免過度分散注意力的動畫
- 提供文字替代資訊

### 動畫時間考量
建議範圍:
- 簡單動畫: 100-200ms
- 複雜動畫: 200-400ms
- 避免過長動畫 (>500ms)
- 提供跳過動畫選項

## 測試策略

### 動畫測試
測試方法:
- 使用 `provideNoopAnimations()` 禁用動畫
- 測試動畫觸發邏輯
- 驗證動畫完成後的狀態
- 模擬動畫回呼

### 除錯技巧
工具與方法:
- Chrome DevTools Animation 面板
- 放慢動畫速度觀察
- 記錄動畫事件
- 視覺化動畫狀態

## 常見動畫場景

### 通知/Toast 訊息
動畫設計:
- 從頂部/底部滑入
- 停留一段時間
- 淡出或滑出
- 可多個訊息堆疊

### 手風琴/摺疊面板
實作要點:
- 高度動畫 (使用 max-height 技巧)
- 旋轉圖示動畫
- 內容淡入淡出
- 平滑展開收合

### 載入指示器
動畫類型:
- 旋轉動畫 (spinner)
- 進度條動畫
- 骨架屏淡入
- 脈衝效果

### 模態對話框
動畫組合:
- 背景遮罩淡入
- 對話框縮放淡入
- 關閉時反向動畫
- 不同尺寸適配

### 卡片翻轉
3D 效果:
- rotateY 翻轉動畫
- 正反面內容切換
- 透視效果設定
- 互動觸發

## 動畫與路由

### 路由動畫設定
配置步驟:
1. 在路由配置添加 data: { animation: '...' }
2. 在 RouterOutlet 上綁定動畫觸發器
3. 定義頁面轉換動畫
4. 處理不同路由間的轉換

### 轉換策略
常見模式:
- 淡入淡出 (最簡單)
- 滑動 (左右或上下)
- 縮放
- 根據導航方向調整

### 效能注意
優化建議:
- 保持路由動畫簡短
- 避免複雜的路由動畫
- 考慮使用 CSS 過渡
- 測試不同裝置效能

## 動畫庫與資源

### 預建動畫
現有資源:
- ng-animate (社群動畫庫)
- 自訂動畫集合
- Material 動畫參考
- 動畫範例專案

### 設計靈感
參考來源:
- Material Design 動畫指南
- iOS Human Interface Guidelines
- 動畫設計網站 (如 Dribbble)
- 優秀應用的動畫研究

## 常見模式與反模式

### ✅ 良好模式
- 使用 GPU 加速屬性 (transform, opacity)
- 保持動畫簡短流暢 (200-400ms)
- 提供動畫完成回呼
- 尊重 prefers-reduced-motion
- 可重用的動畫定義

### ❌ 應避免
- 動畫 width/height/top/left
- 過長或過慢的動畫
- 同時過多元素動畫
- 忽略無障礙需求
- 過度複雜的動畫邏輯

## 動畫除錯

### 常見問題
排查方向:
- 動畫未觸發 (檢查狀態變化)
- 動畫閃爍 (檢查初始狀態)
- 動畫卡頓 (檢查屬性選擇)
- 動畫衝突 (檢查多個觸發器)

### 除錯工具
實用工具:
- Chrome DevTools Animation 面板
- Angular DevTools (狀態追蹤)
- 瀏覽器效能分析器
- 自訂除錯 logs

## 未來趨勢

### Web Animations API 進展
關注方向:
- 原生瀏覽器支援改進
- 新的動畫控制選項
- 效能優化
- 跨瀏覽器一致性

### Angular 動畫演進
可能方向:
- 更好的 Signals 整合
- 簡化的 API
- 更強的型別支援
- 視覺化動畫編輯工具

## 學習資源

### 官方文件
- Angular 動畫指南
- API 參考文件
- 動畫範例
- 最佳實踐建議

### 實踐建議
學習路徑:
1. 掌握基本動畫語法
2. 實作常見動畫效果
3. 研究效能優化
4. 探索進階技巧
5. 建構動畫庫

## 專案整合

### 動畫組織
程式碼結構:
- 獨立動畫檔案 (animations.ts)
- 按功能分類動畫
- 可重用的動畫定義
- 統一的命名規範

### 團隊協作
最佳實踐:
- 文件化動畫用途和參數
- 提供動畫範例和預覽
- Code review 關注效能
- 建立動畫設計規範