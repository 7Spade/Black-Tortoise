<!--
  Demo Context Page Template
  
  Domain-Driven Design: Presentation Layer
  Architecture: Zone-less, Signal-based Reactivity
  
  This template demonstrates signal-based subscriptions using modern Angular control flow
-->

<div class="demo-context-page">
  <!-- Header Section -->
  <header class="page-header">
    <h1>Application Context Store Demo</h1>
    <p class="subtitle">Zone-less Signal-based State Management</p>
  </header>

  <!-- Demo Controls -->
  <section class="demo-controls">
    <button class="btn btn-primary" (click)="loadDemo()">
      Load Demo Data
    </button>
    <button class="btn btn-secondary" (click)="onReset()">
      Reset Store
    </button>
  </section>

  <!-- Error Display -->
  @if (appContext.error(); as error) {
    <div class="error-banner">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span class="error-message">{{ error }}</span>
      <button class="btn-close" (click)="onClearError()">√ó</button>
    </div>
  }

  <!-- Loading State -->
  @if (appContext.isLoading()) {
    <div class="loading-banner">
      <span class="loading-spinner">‚è≥</span>
      <span>Loading...</span>
    </div>
  }

  <!-- Main Content Grid -->
  <div class="content-grid">
    
    <!-- Identity Section -->
    <section class="info-card">
      <h2>Current Identity</h2>
      @if (appContext.currentIdentity(); as identity) {
        <div class="identity-info">
          <div class="info-row">
            <span class="label">Type:</span>
            <span class="value">{{ identity.type }}</span>
          </div>
          <div class="info-row">
            <span class="label">Name:</span>
            <span class="value">{{ identity.displayName }}</span>
          </div>
          <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{ identity.email ?? 'N/A' }}</span>
          </div>
          <div class="info-row">
            <span class="label">ID:</span>
            <span class="value mono">{{ identity.id }}</span>
          </div>
        </div>
      } @else {
        <div class="empty-state">
          <span class="empty-icon">üë§</span>
          <p>No identity loaded</p>
          <p class="hint">Click "Load Demo Data" to populate</p>
        </div>
      }
    </section>

    <!-- Workspace Section -->
    <section class="info-card">
      <h2>Current Workspace</h2>
      @if (appContext.currentWorkspace(); as workspace) {
        <div class="workspace-info">
          <div class="info-row">
            <span class="label">Name:</span>
            <span class="value">{{ workspace.name }}</span>
          </div>
          <div class="info-row">
            <span class="label">Owner Type:</span>
            <span class="value">{{ workspace.ownerType }}</span>
          </div>
          <div class="info-row">
            <span class="label">Owner ID:</span>
            <span class="value mono">{{ workspace.ownerId }}</span>
          </div>
          <div class="info-row">
            <span class="label">Workspace ID:</span>
            <span class="value mono">{{ workspace.id }}</span>
          </div>
          <div class="info-row">
            <span class="label">Enabled Modules:</span>
            <span class="value">{{ workspace.enabledModules.length }}</span>
          </div>
        </div>
      } @else {
        <div class="empty-state">
          <span class="empty-icon">üè¢</span>
          <p>No workspace selected</p>
          <p class="hint">Load demo data and select a workspace</p>
        </div>
      }
    </section>

    <!-- Module Section -->
    <section class="info-card">
      <h2>Current Module</h2>
      @if (appContext.currentModule(); as module) {
        <div class="module-info">
          <div class="info-row">
            <span class="label">Type:</span>
            <span class="value">{{ module.type }}</span>
          </div>
          <div class="info-row">
            <span class="label">Label:</span>
            <span class="value">{{ module.label }}</span>
          </div>
          <div class="info-row">
            <span class="label">Path:</span>
            <span class="value mono">{{ module.path }}</span>
          </div>
        </div>
      } @else {
        <div class="empty-state">
          <span class="empty-icon">üì¶</span>
          <p>No module active</p>
          <p class="hint">Select a workspace to activate modules</p>
        </div>
      }
    </section>

    <!-- Computed Signals Section -->
    <section class="info-card">
      <h2>Computed Signals</h2>
      <div class="computed-info">
        <div class="info-row">
          <span class="label">Authenticated:</span>
          <span class="value badge" [class.badge-success]="appContext.isAuthenticated()" [class.badge-error]="!appContext.isAuthenticated()">
            {{ appContext.isAuthenticated() ? 'Yes' : 'No' }}
          </span>
        </div>
        <div class="info-row">
          <span class="label">Has Workspace:</span>
          <span class="value badge" [class.badge-success]="appContext.hasWorkspaceContext()" [class.badge-error]="!appContext.hasWorkspaceContext()">
            {{ appContext.hasWorkspaceContext() ? 'Yes' : 'No' }}
          </span>
        </div>
        <div class="info-row">
          <span class="label">Workspace Count:</span>
          <span class="value">{{ appContext.workspaceCount() }}</span>
        </div>
        <div class="info-row">
          <span class="label">Active Modules:</span>
          <span class="value">{{ appContext.activeWorkspaceModules().length }}</span>
        </div>
        <div class="info-row">
          <span class="label">Identity Name:</span>
          <span class="value">{{ appContext.currentIdentityName() }}</span>
        </div>
        <div class="info-row">
          <span class="label">Workspace Name:</span>
          <span class="value">{{ appContext.currentWorkspaceName() }}</span>
        </div>
      </div>
    </section>

  </div>

  <!-- Workspace Selector -->
  <section class="selector-section">
    <h2>Available Workspaces ({{ appContext.workspaceCount() }})</h2>
    @if (appContext.availableWorkspaces().length > 0) {
      <div class="workspace-grid">
        @for (workspace of appContext.availableWorkspaces(); track workspace.id) {
          <div 
            class="workspace-card" 
            [class.active]="appContext.currentWorkspace()?.id === workspace.id"
            (click)="onSelectWorkspace(workspace.id)"
          >
            <div class="workspace-header">
              <h3>{{ workspace.name }}</h3>
              @if (appContext.currentWorkspace()?.id === workspace.id) {
                <span class="active-badge">Active</span>
              }
            </div>
            <div class="workspace-meta">
              <span class="meta-item">{{ workspace.ownerType }}</span>
              <span class="meta-item">{{ workspace.enabledModules.length }} modules</span>
            </div>
            <div class="workspace-id">ID: {{ workspace.id }}</div>
          </div>
        }
      </div>
    } @else {
      <div class="empty-state">
        <span class="empty-icon">üìã</span>
        <p>No workspaces available</p>
        <p class="hint">Load demo data to see workspaces</p>
      </div>
    }
  </section>

  <!-- Module Selector -->
  <section class="selector-section">
    <h2>Module Selector</h2>
    @if (appContext.hasWorkspaceContext()) {
      <div class="module-grid">
        @for (module of availableModules; track module.type) {
          <button 
            class="module-button"
            [class.active]="appContext.currentModule()?.type === module.type"
            [disabled]="!isModuleEnabled(module.type)"
            (click)="onSelectModule(module.type)"
          >
            <span class="module-icon">{{ module.icon }}</span>
            <span class="module-label">{{ module.label }}</span>
            @if (!isModuleEnabled(module.type)) {
              <span class="disabled-badge">Disabled</span>
            }
            @if (appContext.currentModule()?.type === module.type) {
              <span class="active-indicator">‚úì</span>
            }
          </button>
        }
      </div>
    } @else {
      <div class="empty-state">
        <span class="empty-icon">üîí</span>
        <p>Select a workspace first</p>
        <p class="hint">Modules are workspace-specific</p>
      </div>
    }
  </section>

  <!-- Architecture Info -->
  <section class="info-section">
    <h2>Architecture Highlights</h2>
    <ul class="feature-list">
      <li>‚úÖ <strong>Zone-less:</strong> No Zone.js dependency, signal-based change detection</li>
      <li>‚úÖ <strong>OnPush Strategy:</strong> Optimal performance with ChangeDetectionStrategy.OnPush</li>
      <li>‚úÖ <strong>Standalone Component:</strong> No NgModule required</li>
      <li>‚úÖ <strong>NgRx Signals:</strong> Type-safe immutable state management</li>
      <li>‚úÖ <strong>Modern Template Syntax:</strong> Using control flow blocks</li>
      <li>‚úÖ <strong>DDD Boundaries:</strong> Presentation ‚Üí Application ‚Üí Domain layers</li>
      <li>‚úÖ <strong>Global Shell:</strong> Application-level singleton store</li>
      <li>‚úÖ <strong>Computed Signals:</strong> Reactive derived state</li>
    </ul>
  </section>

</div>
